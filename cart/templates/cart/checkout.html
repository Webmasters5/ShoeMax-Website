{% extends 'cart/top-bar.html' %}
{% load static %}
{% block title %}Checkout{% endblock %}

{% block extra_head %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container-fluid" style="margin-top: 72px;"> <!-- ensure not hidden behind fixed top bar -->
  <div class="row gx-4">
    <div class="col-12 col-md-8">
      <h1 class="mb-4">Checkout</h1>

      <form method="POST" class="row g-3">
        {% csrf_token %}

        <div class="col-12">
          <label for="full_name" class="form-label">Full Name</label>
          <input id="full_name" name="full_name" type="text" class="form-control" required
                 value="{{ customer.user.get_full_name|default:customer.user.username }}">
        </div>

        <div class="col-12">
          <label for="email" class="form-label">Email</label>
          <input id="email" name="email" type="email" class="form-control" required
                 value="{{ customer.user.email|default_if_none:'' }}">
        </div>

        <div class="col-12">
          <label for="address" class="form-label">Shipping Address</label>
          <textarea id="address" name="address" class="form-control" rows="3" required>{{ customer.shipping_address|default_if_none:'' }}</textarea>
        </div>

        <div class="col-12 col-md-6">
          <label for="payment" class="form-label">Payment Method</label>
          <select id="payment" name="payment" class="form-select" required>
            <option value="">Select</option>
            <option value="card">Credit/Debit Card</option>
            <option value="cod">Cash on Delivery</option>
          </select>
        </div>

        <div class="col-12">
          <button type="submit" class="btn btn-primary">Place Order</button>
        </div>
      </form>
    </div>

    <div class="col-12 col-md-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title mb-3">Order Summary</h5>

          <ul class="list-group list-group-flush mb-3">
            {% for item in cart_items %}
            <li class="list-group-item d-flex justify-content-between align-items-start">
              <div>
                <div class="fw-semibold">{{ item.variant.shoe.name }}</div>
                <small class="text-muted">Quantity: {{ item.quantity }}</small>
              </div>
              <span class="ms-2">Rs {{ item.total_price }}</span>
            </li>
            {% endfor %}
          </ul>

          <ul class="list-group list-group-flush mb-3">
            <li class="list-group-item d-flex justify-content-between">
              <span>Subtotal</span>
              <strong>Rs {{ total }}</strong>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Discount</span>
              <strong>Rs {{ discount }}</strong>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Total</span>
              <strong>Rs {{ final_total }}</strong>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
