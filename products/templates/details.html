{% extends "BaseTemplate/nav.html" %}
{% load static %}

{% block title %}{{ shoe.name }} - ShoeMax{% endblock %}

{% block extra_head %}
  <meta name="author" content="ShoeMax Ltd." />
  <meta name="keywords" content="" />
  <meta name="description" content="Product details page for {{ shoe.name }}" />

  <link rel="stylesheet" href="{% static 'css/details.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  <nav class="breadcrumb">
    <a href="#">Home</a> /
    <a href="#">{{shoe.gender}}</a> /
    <span>{{shoe.category}}</span>
  </nav>

  <main class="product-container">
    <div class="product-gallery">
      <div class="main-image">
        {% if main_image %}
          <img src="{{ main_image.image.url }}" alt="{{ main_image.alt_text }}">
        {% else %}
          <img src="{% static 'images/image1.png' %}" alt="{{ shoe.name }}">
        {% endif %}
      </div>
      <div class="thumbnail-grid" style="display: flex; gap: 10px;">
        {% for image in shoe.images.all %}
          <img src="{{ image.image.url }}" alt="{{ image.alt_text }}" style="width: 100px; height: 100px; object-fit: cover;">
        {% empty %}
          <img src="{% static 'images/image1.png' %}" alt="Product view 1" style="width: 100px; height: 100px; object-fit: cover;">
          <img src="{% static 'images/image2.png' %}" alt="Product view 2" style="width: 100px; height: 100px; object-fit: cover;">
          <img src="{% static 'images/image3.png' %}" alt="Product view 3" style="width: 100px; height: 100px; object-fit: cover;">
        {% endfor %}
      </div>
    </div>

    <div class="product-info">
      <h1 class="product-title">{{ shoe.name }}</h1>
      <form method="post" action="{% url 'products:wishlist_add' shoe.shoe_id %}" style="display:inline-block;margin-top:8px;">
        {% csrf_token %}
        <button type="submit" aria-label="Add to wishlist" title="Add to wishlist" style="background:none;border:none;">
          <i class="far fa-heart"></i>
        </button>
      </form>
      <p class="product-price"><b>Price:</b> Rs {{ shoe.price }}</p>
      <p class="product-brand"><b>Brand:</b> {{ shoe.brand.name }}</p>
 
      <form method="get" id="colorForm">
        <h2 class="section-title">Color Options</h2>
        <div class="color-options">
          {% if color_available %}
            {% for color, available in color_available.items %}
            <div class="color-item">
              <input
                type="radio"
                id="color_{{ color }}"
                name="color"
                value="{{ color }}"
                {% if color == selected_color %}checked{% endif %}
                class="color-input"
                {% if not available %}disabled{% endif %}
                onchange="this.form.submit();"
              >
              <label for="color_{{ color }}" class="color-option">{{ color }}</label>
            </div>
            {% endfor %}
          {% else %}
            <p>No color options available.</p>
          {% endif %}
        </div>
      </form>
 
       <form id="sizeForm" method="post" action="{% url 'cart:add_item'%}">
         {% csrf_token %}
         <h2 class="section-title">Available Sizes</h2>
         <div class="variant-options">
           {% if variants %}
             {% for variant in variants %}
             <div class="variant-item">
              <input type="radio" id="variant_{{ variant.variant_id }}" name="variant" value="{{ variant.variant_id }}" class="variant-input" {% if forloop.first %}checked{% endif %} {% if variant.stock <= 0 %}disabled{% endif %}>
              <label for="variant_{{ variant.variant_id }}" class="variant-option">{{ variant.size }}</label>
             </div>
             {% endfor %}
           {% else %}
             <p>No variants available for this product.</p>
           {% endif %}
         </div>
         <input type="hidden" name="color" value="{{ selected_color }}">
         <button type="submit" class="add-to-cart">Add to Cart</button>
       </form>
       <div class="product-description">
         <h2 class="section-title">Product Description</h2>
         <p>
         {{ shoe.description }}
         </p>
        {% if avg_rating %}
        <p>Rating: {{ avg_rating }} / 5 â˜…</p>
        {% endif %}
       </div>
     </div>
    <div>
       <a href="{% url 'products:reviews' shoe.shoe_id%}" class="btn btn-outline-success">View reviews</a>
     </div>
   </main>
 </div>
 {% endblock %}
