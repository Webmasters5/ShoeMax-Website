{% extends "BaseTemplate/nav.html" %}
{% load static %}

{% block title %}{{ product.name }} - ShoeMax{% endblock %}

{% block meta %}
  <meta name="author" content="ShoeMax Ltd." />
  <meta name="keywords" content="" />
  <meta name="description" content="Product details page for {{ product.name }}" />
{% endblock %}

{% block stylesheet %}
  <link rel="stylesheet" href="{% static 'css/details.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  <nav class="breadcrumb">
    <a href="#">Home</a> /
    <a href="#">{{product.gender}}</a> /
    <span>{{product.category}}</span>
  </nav>

  <main class="product-container">
    <div class="product-gallery">
      <div class="main-image">
        {% if product.image_url %}
          <img src="{{ product.image_url.url }}" alt="{{ product.name }}">
        {% else %}
          <img src="{% static 'images/image1.png' %}" alt="{{ product.name }}">
        {% endif %}
      </div>
      <div class="thumbnail-grid" style="display: flex; gap: 10px;">
        <img src="{% static 'images/image1.png' %}" alt="Product view 1" style="width: 100px; height: 100px; object-fit: cover;">
        <img src="{% static 'images/image2.png' %}" alt="Product view 2" style="width: 100px; height: 100px; object-fit: cover;">
        <img src="{% static 'images/image3.png' %}" alt="Product view 3" style="width: 100px; height: 100px; object-fit: cover;">
      </div>
    </div>

    <div class="product-info">
      <h1 class="product-title">{{ product.name }}</h1>
      <p class="product-price"> <b>Price:</b> ${{ product.price }}</p>
      <p class="product-brand"> <b>Brand:</b> {{ product.brand.name }}</p>
      <p class="product-color"> <b>Color:</b> {{ product.color }}</p>
      <p class="product-size"> <b>Size:</b> {{ product.size }}</p>
      <form method="post" action="#">
        {% csrf_token %}
        <input type="hidden" name="product_id" value="{{ product.shoe_id }}">
        
        <h2 class="section-title">Color Options</h2>
        <div class="color-options">
          {% if product.variants.all %}
            {% regroup product.variants.all by color as color_groups %}
            {% for color_group in color_groups %}
            <div class="color-item">
              <input type="radio" id="color_{{ color_group.grouper|slugify }}" name="selected_color" value="{{ color_group.grouper }}" {% if forloop.first %}checked{% endif %} class="color-input">
              <label for="color_{{ color_group.grouper|slugify }}" class="color-option">{{ color_group.grouper }}</label>
            </div>
            {% endfor %}
          {% else %}
            <p>No color options available.</p>
          {% endif %}
        </div>

        <h2 class="section-title">Available Variants</h2>
        <div class="variant-options">
          {% if product.variants.all %}
            {% for variant in product.variants.all %}
            <div class="variant-item">
              <input type="radio" id="variant_{{ variant.variant_id }}" name="variant" value="{{ variant.variant_id }}" {% if forloop.first %}checked{% endif %} class="variant-input">
              <label for="variant_{{ variant.variant_id }}" class="variant-option">{{ variant.color }} - Size {{ variant.size }} (Stock: {{ variant.stock }})</label>
            </div>
            {% endfor %}
          {% else %}
            <p>No variants available for this product.</p>
          {% endif %}
        </div>
        <button type="submit" class="add-to-cart">Add to Cart</button>
      </form>
      <div class="product-description">
        <h2 class="section-title">Product Description</h2>
        <p>
        {{ product.description }}
        </p>
        <p>{% if avg_rating %} <!--Added this-->>
        Rating: {{avg_rating}} / 5 â˜…
        {% endif %}</p>
      </div>
    </div>
    <div> <!--And this-->>
      <a href="{% url 'products:reviews' product.shoe_id%}" class="btn btn-outline-success">View reviews</a>
    </div>
  </main>
</div>
{% endblock %}
