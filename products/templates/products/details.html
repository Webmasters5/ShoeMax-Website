{% extends "BaseTemplate/base.html" %}
{% load static %}

{% block title %}{{ shoe.name }} - ShoeMax{% endblock %}

{% block extra_head %}
  <meta name="author" content="ShoeMax Ltd." />
  <meta name="keywords" content="" />
  <meta name="description" content="Product details page for {{ shoe.name }}" />
{% endblock %}

<!-- https://bootstrapexamples.com/@andreas-muller/product-details-page -->
{% block content %}
<div class="container my-4">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{% url 'storefront:home' %}">Home</a></li>
      <li class="breadcrumb-item">
        <a href="{% url 'products:by_gender' shoe.gender %}">{{ shoe.get_gender_display }}</a>
      </li>
      <li class="breadcrumb-item">
        <a href="{% url 'products:by_gender' shoe.gender %}?category={{ shoe.category }}">{{ shoe.get_category_display }}</a>
      </li>
      <li class="breadcrumb-item active">{{shoe.name}}</li>

    </ol>
  </nav>

  <main class="product-container">
    <div class="row gx-4">
      <div class="col-lg-6">
        <div class="card">
          <div class="card-body">
            <div class="mb-3 text-center">
              {% if main_image %}
                <img src="{{ main_image.image.url }}" alt="{{ main_image.alt_text }}" class="img-fluid rounded">
              {% else %}
                <img src="{% static 'images/image1.png' %}" alt="{{ shoe.name }}" class="img-fluid rounded">
              {% endif %}
            </div>

            <div class="d-flex flex-wrap gap-2 justify-content-center">
              {% for image in shoe.images.all %}
                <img src="{{ image.image.url }}" alt="{{ image.alt_text }}" class="img-thumbnail" style="width:96px;height:96px;object-fit:cover;cursor:pointer;">
              {% empty %}
                <img src="{% static 'images/image1.png' %}" alt="Product view 1" class="img-thumbnail" style="width:96px;height:96px;object-fit:cover;">
                <img src="{% static 'images/image2.png' %}" alt="Product view 2" class="img-thumbnail" style="width:96px;height:96px;object-fit:cover;">
                <img src="{% static 'images/image3.png' %}" alt="Product view 3" class="img-thumbnail" style="width:96px;height:96px;object-fit:cover;">
              {% endfor %}
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-body d-flex flex-column">
            <div class="d-flex align-items-start justify-content-between">
              <div>
                <h1 class="h3 mb-1">{{ shoe.name }}</h1>
                <p class="text-muted mb-2">{{ shoe.brand.name }}</p>
              </div>
              <div>
                <form method="post" action="{% url 'products:wishlist_add' shoe.shoe_id %}">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-outline-danger" aria-label="Add to wishlist" title="Add to wishlist">
                    <i class="far fa-heart"></i>
                  </button>
                </form>
              </div>
            </div>

            <div class="mb-3">
              <h3 class="h4 text-primary">Rs {{ shoe.price }}</h3>
              {% if avg_rating %}
                <span class="badge bg-success">Rating: {{ avg_rating }} / 5 â˜…</span>
              {% endif %}
              {% if shoe.total_stock == 0 %}
                <span class="badge bg-danger ms-2">Out of stock</span>
              {% endif %}
            </div>

            <div class="mb-3">
              <form method="get" id="colorForm" class="mb-2">
                <label class="form-label fw-semibold">Color</label>
                <div class="d-flex gap-2 flex-wrap">
                  {% if color_available %}
                    {% for color, available in color_available.items %}
                      <div>
                        <input type="radio" class="btn-check" name="color" id="color_{{ color }}" value="{{ color }}" autocomplete="off" {% if color == selected_color %}checked{% endif %} {% if not available %}disabled{% endif %} onchange="this.form.submit();">
                        <label class="btn btn-outline-secondary btn-sm" for="color_{{ color }}">{{ color }}</label>
                      </div>
                    {% endfor %}
                  {% else %}
                    <div class="text-muted">No color options available.</div>
                  {% endif %}
                </div>
              </form>

              <form id="sizeForm" method="post" action="{% url 'cart:add_item' %}">
                {% csrf_token %}
                <label class="form-label fw-semibold">Size</label>
                <div class="d-flex gap-2 flex-wrap mb-3">
                  {% if variants %}
                    {% for variant in variants %}
                      <div>
                        <input type="radio" class="btn-check" name="variant" id="variant_{{ variant.variant_id }}" value="{{ variant.variant_id }}" autocomplete="off" {% if forloop.first %}checked{% endif %} {% if variant.stock <= 0 %}disabled{% endif %}>
                        <label class="btn btn-outline-primary btn-sm" for="variant_{{ variant.variant_id }}">{{ variant.size }}</label>
                      </div>
                    {% endfor %}
                  {% else %}
                    <div class="text-muted">No variants available for this product.</div>
                  {% endif %}
                </div>

                <input type="hidden" name="color" value="{{ selected_color }}">
                <div class="d-flex gap-2">
                  <button type="submit" class="btn btn-primary" {% if shoe.total_stock == 0 %}disabled{% endif %}>Add to Cart</button>
                  <a href="{% url 'products:reviews' shoe.shoe_id %}" class="btn btn-outline-success">View reviews</a>
                </div>
              </form>
            </div>

            <div class="mt-auto">
              <h5 class="h6">Product Description</h5>
              <p class="text-muted">{{ shoe.description }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
 {% endblock %}
